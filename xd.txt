–û–∫, –¥–∞–≤–∞–π —á—ë—Ç–∫–æ: —è —Å–µ–π—á–∞—Å —Å–¥–µ–ª–∞—é —Ç–µ–±–µ –∫–æ–Ω–µ—á–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–æ–¥–∞ –¥–ª—è –∑–∞–¥–∞–Ω–∏–π 1‚Äì4, —á—Ç–æ–±—ã:

–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–ª–∞,

–±—ã–ª–∞ –º–æ–¥–µ–ª—å Role + –µ—ë —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π/–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä/–≤–∞–ª–∏–¥–∞—Ç–æ—Ä,

CreateUser –≤–æ–∑–≤—Ä–∞—â–∞–ª 201 Created,

—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—ã–ª –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º, –∫–∞–∫ –≤ –º–µ—Ç–æ–¥–∏—á–∫–µ.
—Ü—Ü—Ü
–¢—ã –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—à—å –º–æ–π –∫–æ–¥ –≤ —Å–≤–æ–∏ —Ñ–∞–π–ª—ã.

–Ø –±—É–¥—É –ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ, –±–µ–∑ –ª–∏—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏ —Å–∫–∞–∑–æ–∫.

0. –ö–∞–∫–æ–π —É —Ç–µ–±—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å Program.cs

Program.cs –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—Ä–æ—Å—Ç—ã–º, –∫–∞–∫ –ø–æ –º–µ—Ç–æ–¥–∏—á–∫–µ + DI:

using SampleApp.API.Interfaces;
using SampleApp.API.Repositories;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddControllers();
builder.Services.AddSwaggerGen();

// DI ‚Äì —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
builder.Services.AddSingleton<IUserRepository, UsersMemoryRepository>();
builder.Services.AddSingleton<IRoleRepository, RoleMemoryRepository>();

var app = builder.Build();

app.UseSwagger();
app.UseSwaggerUI();

app.MapControllers();

app.Run();


–í–∞–∂–Ω–æ: –∫–ª–∞—Å—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è UsersMemoryRepository (—Å –±—É–∫–≤–æ–π s –≤ –Ω–∞—á–∞–ª–µ), —á—Ç–æ–±—ã —Å–æ–≤–ø–∞–¥–∞–ª–æ —Å –∫–æ–¥–æ–º –Ω–∏–∂–µ.

1. –ó–∞–¥–∞–Ω–∏–µ 1 + 3: User, –≤–∞–ª–∏–¥–∞—Ç–æ—Ä, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å 201 Created
1.1. Entities/User.cs
namespace SampleApp.API.Entities
{
    public class User
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
    }
}

1.2. Validations/UserValidator.cs
using FluentValidation;
using SampleApp.API.Entities;

namespace SampleApp.API.Validations
{
    public class UserValidator : AbstractValidator<User>
    {
        public UserValidator()
        {
            RuleFor(u => u.Name)
                .NotEmpty().WithMessage("–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ")
                .Length(2, 50).WithMessage("–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 2 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤")
                .Must(StartsWithCapitalLetter).WithMessage("–ò–º—è –¥–æ–ª–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã");
            
            RuleFor(u => u.Id)
                .GreaterThan(0).WithMessage("ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º");
        }

        private bool StartsWithCapitalLetter(string name)
        {
            if (string.IsNullOrEmpty(name)) return false;
            return char.IsUpper(name[0]);
        }
    }
}


–≠—Ç–æ —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ –º–µ—Ç–æ–¥–∏—á–∫–µ.

1.3. –ó–∞–¥–∞–Ω–∏–µ 4 —Ç—Ä–µ–±—É–µ—Ç UserRequestOption (–¥–ª—è async)

–°—Ä–∞–∑—É —Å–æ–∑–¥–∞—ë–º –∑–∞–≥–ª—É—à–∫—É, —á—Ç–æ–±—ã –≤—Å—ë –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–ª–æ—Å—å.

Entities/UserRequestOption.cs

namespace SampleApp.API.Entities
{
    public class UserRequestOption
    {
        // —Ç—É—Ç –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä, –ø–æ–∫–∞ –ø—É—Å—Ç–æ
    }
}

1.4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–ó–∞–¥–∞–Ω–∏–µ 4 ‚Äì –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)

‚ÄºÔ∏è –í–∞–∂–Ω–æ: –ø–æ –º–µ—Ç–æ–¥–∏—á–∫–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫.
–ú—ã –∑–∞–º–µ–Ω—è–µ–º —Ç–≤–æ–π —Å—Ç–∞—Ä—ã–π IUserRepository –Ω–∞ —ç—Ç–æ—Ç.

Interfaces/IUserRepository.cs

using System.Collections.Generic;
using System.Threading.Tasks;
using SampleApp.API.Entities;

namespace SampleApp.API.Interfaces
{
    public interface IUserRepository
    {
        Task<User> CreateUserAsync(User user);
        Task<List<User>> GetUsersAsync(UserRequestOption option);
        Task<User> EditUserAsync(User user, int id);
        Task<bool> DeleteUserAsync(int id);
        Task<User> FindUserByIdAsync(int id);
        Task<User> FindUserByLoginAsync(string login);
    }
}

1.5. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è async-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (UsersMemoryRepository)

Repositories/UsersMemoryRepository.cs

using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using SampleApp.API.Entities;
using SampleApp.API.Interfaces;

namespace SampleApp.API.Repositories
{
    public class UsersMemoryRepository : IUserRepository
    {
        private readonly List<User> _users = new();

        public Task<User> CreateUserAsync(User user)
        {
            _users.Add(user);
            return Task.FromResult(user);
        }

        public Task<bool> DeleteUserAsync(int id)
        {
            var result = _users.FirstOrDefault(u => u.Id == id);

            if (result == null)
            {
                throw new Exception($"–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å id = {id}");
            }

            _users.Remove(result);
            return Task.FromResult(true);
        }

        public Task<User> EditUserAsync(User user, int id)
        {
            var result = _users.FirstOrDefault(u => u.Id == id);

            if (result == null)
            {
                throw new Exception($"–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å id = {id}");
            }

            result.Name = user.Name;
            return Task.FromResult(result);
        }

        public Task<User> FindUserByIdAsync(int id)
        {
            var result = _users.FirstOrDefault(u => u.Id == id);

            if (result == null)
            {
                throw new Exception($"–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å id = {id}");
            }

            return Task.FromResult(result);
        }

        public Task<User> FindUserByLoginAsync(string login)
        {
            // –õ–æ–≥–∏–Ω–∞ —É –Ω–∞—Å –Ω–µ—Ç, —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è
            var result = _users.FirstOrDefault(u => u.Name == login);
            return Task.FromResult(result!);
        }

        public Task<List<User>> GetUsersAsync(UserRequestOption option)
        {
            // –ø–æ–∫–∞ –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            return Task.FromResult(_users.ToList());
        }
    }
}

1.6. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä Users (–≤–∞–ª–∏–¥–∞—Ç–æ—Ä + 201 + async)

Controllers/UsersController.cs

using Microsoft.AspNetCore.Mvc;
using SampleApp.API.Entities;
using SampleApp.API.Interfaces;
using SampleApp.API.Validations;
using System.Linq;
using System.Threading.Tasks;

namespace SampleApp.API.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class UsersController : ControllerBase
    {
        private readonly IUserRepository _repo;
    
        public UsersController(IUserRepository repo)
        {
            _repo = repo;
        }

        // –ó–∞–¥–∞–Ω–∏–µ 3: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å-–∫–æ–¥ 201 + –≤–∞–ª–∏–¥–∞—Ü–∏—è (–ó–∞–¥–∞–Ω–∏–µ 1)
        [HttpPost]
        public async Task<ActionResult> CreateUser(User user)
        {
            var validator = new UserValidator();
            var result = validator.Validate(user);
    
            if (!result.IsValid)
            {
                return BadRequest(result.Errors.First().ErrorMessage);
            }
    
            var createdUser = await _repo.CreateUserAsync(user);
            return CreatedAtAction(nameof(GetUserById), new { id = createdUser.Id }, createdUser);
        }
    
        [HttpGet]
        public async Task<ActionResult> GetUsers()
        {
            var users = await _repo.GetUsersAsync(new UserRequestOption());
            return Ok(users);
        }
    
        [HttpPut]
        public async Task<ActionResult> UpdateUser(User user)
        {
            var updated = await _repo.EditUserAsync(user, user.Id);
            return Ok(updated);
        }

        [HttpGet("{id}")]
        public async Task<ActionResult> GetUserById(int id)
        {
            var user = await _repo.FindUserByIdAsync(id);
            return Ok(user);
        }

        [HttpDelete("{id}")]
        public async Task<ActionResult> DeleteUser(int id)
        {
            var deleted = await _repo.DeleteUserAsync(id);
            return Ok(deleted);
        }
    }
}


üëâ –ó–¥–µ—Å—å —É —Ç–µ–±—è:

–≤–∞–ª–∏–¥–∞—Ü–∏—è (–ó–∞–¥–∞–Ω–∏–µ 1),

—Å—Ç–∞—Ç—É—Å-–∫–æ–¥ 201 (–ó–∞–¥–∞–Ω–∏–µ 3),

async-–º–µ—Ç–æ–¥—ã (–ó–∞–¥–∞–Ω–∏–µ 4, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è).

2. –ó–∞–¥–∞–Ω–∏–µ 2: Role (–º–æ–¥–µ–ª—å + —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π + –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä + –≤–∞–ª–∏–¥–∞—Ç–æ—Ä)

–¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–π –Ω–∞–±–æ—Ä ‚Äì Role.

2.1. –ú–æ–¥–µ–ª—å Role ‚Äì Entities/Role.cs
namespace SampleApp.API.Entities
{
    public class Role
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
    }
}

2.2. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å IRoleRepository ‚Äì Interfaces/IRoleRepository.cs
using System.Collections.Generic;
using SampleApp.API.Entities;

namespace SampleApp.API.Interfaces
{
    public interface IRoleRepository
    {
        Role CreateRole(Role role);
        List<Role> GetRoles();
        Role EditRole(Role role, int id);
        bool DeleteRole(int id);
        Role FindRoleById(int id);
    }
}

2.3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è RoleMemoryRepository ‚Äì Repositories/RoleMemoryRepository.cs
using System;
using System.Collections.Generic;
using System.Linq;
using SampleApp.API.Entities;
using SampleApp.API.Interfaces;

namespace SampleApp.API.Repositories
{
    public class RoleMemoryRepository : IRoleRepository
    {
        private readonly List<Role> _roles = new();

        public Role CreateRole(Role role)
        {
            _roles.Add(role);
            return role;
        }

        public bool DeleteRole(int id)
        {
            var result = _roles.FirstOrDefault(r => r.Id == id);

            if (result == null)
            {
                throw new Exception($"–ù–µ—Ç —Ä–æ–ª–∏ —Å id = {id}");
            }

            _roles.Remove(result);
            return true;
        }

        public Role EditRole(Role role, int id)
        {
            var result = _roles.FirstOrDefault(r => r.Id == id);

            if (result == null)
            {
                throw new Exception($"–ù–µ—Ç —Ä–æ–ª–∏ —Å id = {id}");
            }

            result.Name = role.Name;
            return result;
        }

        public Role FindRoleById(int id)
        {
            var result = _roles.FirstOrDefault(r => r.Id == id);

            if (result == null)
            {
                throw new Exception($"–ù–µ—Ç —Ä–æ–ª–∏ —Å id = {id}");
            }

            return result;
        }

        public List<Role> GetRoles()
        {
            return _roles.ToList();
        }
    }
}

2.4. –í–∞–ª–∏–¥–∞—Ç–æ—Ä RoleValidator ‚Äì Validations/RoleValidator.cs
using FluentValidation;
using SampleApp.API.Entities;

namespace SampleApp.API.Validations
{
    public class RoleValidator : AbstractValidator<Role>
    {
        public RoleValidator()
        {
            RuleFor(r => r.Name)
                .NotEmpty().WithMessage("–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ")
                .Length(2, 50).WithMessage("–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 2 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤");
        }
    }
}

2.5. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä RolesController ‚Äì Controllers/RolesController.cs
using Microsoft.AspNetCore.Mvc;
using SampleApp.API.Entities;
using SampleApp.API.Interfaces;
using SampleApp.API.Validations;
using System.Linq;
using System.Collections.Generic;

namespace SampleApp.API.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class RolesController : ControllerBase
    {
        private readonly IRoleRepository _repo;

        public RolesController(IRoleRepository repo)
        {
            _repo = repo;
        }

        [HttpPost]
        public ActionResult CreateRole(Role role)
        {
            var validator = new RoleValidator();
            var result = validator.Validate(role);

            if (!result.IsValid)
            {
                return BadRequest(result.Errors.First().ErrorMessage);
            }

            return Ok(_repo.CreateRole(role));
        }

        [HttpGet]
        public ActionResult GetRoles()
        {
            var roles = _repo.GetRoles();

            if (roles == null || roles.Count == 0)
                return NotFound();

            return Ok(roles);
        }

        [HttpGet("{id}")]
        public ActionResult GetRoleById(int id)
        {
            return Ok(_repo.FindRoleById(id));
        }

        [HttpPut]
        public ActionResult UpdateRole(Role role)
        {
            return Ok(_repo.EditRole(role, role.Id));
        }

        [HttpDelete("{id}")]
        public ActionResult DeleteRole(int id)
        {
            return Ok(_repo.DeleteRole(id));
        }
    }
}


–í—Å—ë, –ó–∞–¥–∞–Ω–∏–µ 2 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: –º–æ–¥–µ–ª—å, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, –≤–∞–ª–∏–¥–∞—Ç–æ—Ä.

3. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å—ë —Å–æ–±—Ä–∞–Ω–æ

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞:

dotnet build
dotnet run


–û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

http://localhost:–ø–æ—Ä—Ç/swagger


–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–≤–∞ –±–ª–æ–∫–∞:

Users ‚Äì —Å –º–µ—Ç–æ–¥–∞–º–∏ POST/GET/PUT/GET{id}/DELETE{id}

Roles ‚Äì —Å —Ç–µ–º–∏ –∂–µ —Ç–∏–ø–∞–º–∏ –º–µ—Ç–æ–¥–æ–≤.

–î–ª—è –ó–∞–¥–∞–Ω–∏—è 1 (–≤–∞–ª–∏–¥–∞—Ü–∏—è):

–≤ POST /api/Users –æ—Ç–ø—Ä–∞–≤—å

{ "id": 0, "name": "" }


‚Üí –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 400 Bad Request —Å —Ç–µ–∫—Å—Ç–æ–º –æ—à–∏–±–∫–∏;

–æ—Ç–ø—Ä–∞–≤—å

{ "id": 1, "name": "–ò–≤–∞–Ω" }


‚Üí 201 Created.

–≠—Ç–æ –∏ –µ—Å—Ç—å ¬´–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏¬ª.

4. –ó–∞–¥–∞–Ω–∏–µ 5 (—Ç–µ—Å—Ç—ã) ‚Äì –æ—Ç–¥–µ–ª—å–Ω–æ

–¢–∞–º —É–∂–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å xUnit-–ø—Ä–æ–µ–∫—Ç, —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–µ–º–∞.
–ï—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å ‚Äî –Ω–∞–ø–∏—à—É —Ç–µ–±–µ –µ—â—ë –æ–¥–∏–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫ ¬´–≤–æ—Ç –∫–æ–º–∞–Ω–¥—ã –∏ –∫–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–æ–≤¬ª, –Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π –∫–æ–¥ –≤—ã—à–µ, —á—Ç–æ–±—ã –ø—Ä–æ–µ–∫—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ —Å–æ–±–∏—Ä–∞–ª—Å—è –∏ Swagger –ø–æ–∫–∞–∑—ã–≤–∞–ª Users + Roles.
